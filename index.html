<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Solar Potential – Greece</title>

<script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>
<link href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" rel="stylesheet"/>

<style>
body { margin:0; overflow:hidden; background:#000; font-family:system-ui; }
#map { width:100vw; height:100vh; }

.panel {
  position:absolute;
  background:rgba(15,15,15,0.96);
  color:#ddd;
  padding:14px;
  border-radius:4px;
  font-size:13px;
  z-index:10;
  line-height:1.4;
}

#legend { bottom:20px; left:20px; width:260px; }

.legend-gradient {
  height:14px;
  background: linear-gradient(to right, #ffe680, #ffb000, #ff7800);
  margin:10px 0;
  border-radius:3px;
}

h3 { margin:0 0 6px 0; color:#fff; font-size:15px; }
.small { font-size:11px; color:#aaa; }
</style>
</head>

<body>

<div id="map"></div>

<div id="legend" class="panel">
  <h3>Solar Irradiation (kWh/m²/year)</h3>
  <div class="legend-gradient"></div>
  <div>1600 → 2000+</div>
</div>

<script>

const MAPTILER_KEY = "fmHz7ZycUzBddOZvkGZO";

const map = new maplibregl.Map({
  container: 'map',
  style: `https://api.maptiler.com/maps/dataviz-dark/style.json?key=${MAPTILER_KEY}`,
  center: [22.5, 39.0],
  zoom: 6.3,
  pitch: 60,
  bearing: -20,
  antialias: true
});

map.addControl(new maplibregl.NavigationControl());

map.on('load', () => {

  // ---------------------------------------------------------------------------
  // Improve lighting for 3D
  // ---------------------------------------------------------------------------

  map.setLight({
    anchor: 'viewport',
    position: [1.5, 90, 40],
    intensity: 0.8,
    color: '#ffffff'
  });

  // ---------------------------------------------------------------------------
  // Solar layer (visible gradient)
  // ---------------------------------------------------------------------------

  map.addSource('solar-raster', {
    type: 'raster',
    tiles: [
      'https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png'
    ],
    tileSize: 256
  });

  map.addLayer({
    id: 'solar-layer',
    type: 'raster',
    source: 'solar-raster',
    paint: {
      'raster-opacity': 0.45,
      'raster-saturation': 1.2,
      'raster-contrast': 0.3,
      'raster-hue-rotate': 40
    }
  });

  // ---------------------------------------------------------------------------
  // 3D Buildings with proper fallback height
  // ---------------------------------------------------------------------------

  const layers = map.getStyle().layers;
  let labelLayerId;

  for (const layer of layers) {
    if (layer.type === 'symbol' && layer.layout['text-field']) {
      labelLayerId = layer.id;
      break;
    }
  }

  map.addLayer({
    id: '3d-buildings',
    source: 'openmaptiles',
    'source-layer': 'building',
    type: 'fill-extrusion',
    minzoom: 14,
    paint: {

      'fill-extrusion-color': '#aaaaaa',

      'fill-extrusion-height': [
        'case',
        ['has', 'height'], ['get', 'height'],
        ['has', 'levels'], ['*', ['get', 'levels'], 4],
        12
      ],

      'fill-extrusion-base': 0,
      'fill-extrusion-opacity': 0.95
    }

  }, labelLayerId);

});

</script>
</body>
</html>
