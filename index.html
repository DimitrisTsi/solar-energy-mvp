<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Solar Greece Clean</title>

<link href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" rel="stylesheet"/>

<style>
body { margin:0; overflow:hidden; }
#map { width:100vw; height:100vh; }
</style>
</head>

<body>

<div id="map"></div>

<script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>

<script>

const MAPTILER_KEY = "fmHz7ZycUzBddOZvkGZO";

const map = new maplibregl.Map({
  container: 'map',
  style: `https://api.maptiler.com/maps/basic-dark/style.json?key=${MAPTILER_KEY}`,
  center: [22.5, 39.0],
  zoom: 6.3,
  pitch: 60,
  bearing: -20,
  antialias: true
});

map.addControl(new maplibregl.NavigationControl());

map.on('load', () => {

  // --------------------------------------------------
  // 3D BUILDINGS
  // --------------------------------------------------

  map.addLayer({
    id: '3d-buildings',
    type: 'fill-extrusion',
    source: 'openmaptiles',
    'source-layer': 'building',
    minzoom: 13,
    paint: {
      'fill-extrusion-color': '#ffffff',
      'fill-extrusion-height': [
        'case',
        ['has', 'height'], ['get', 'height'],
        ['has', 'levels'], ['*', ['get', 'levels'], 5],
        35
      ],
      'fill-extrusion-opacity': 0.95
    }
  });

  map.setLight({
    anchor: 'viewport',
    position: [2, 90, 60],
    intensity: 1
  });

  // --------------------------------------------------
  // SOLAR POINT DATA
  // --------------------------------------------------

  const solarPoints = [];

  const step = 0.25;

  for (let lon = 19; lon <= 28; lon += step) {
    for (let lat = 34; lat <= 42; lat += step) {

      const base = 1600;
      const southBoost = (42 - lat) * 90;
      const value = base + southBoost;

      solarPoints.push({
        type: "Feature",
        properties: { solar: value },
        geometry: {
          type: "Point",
          coordinates: [lon, lat]
        }
      });
    }
  }

  map.addSource('solar', {
    type: 'geojson',
    data: {
      type: "FeatureCollection",
      features: solarPoints
    }
  });

  // --------------------------------------------------
  // HEATMAP LAYER (Native MapLibre)
  // --------------------------------------------------

  map.addLayer({
    id: 'solar-heatmap',
    type: 'heatmap',
    source: 'solar',
    maxzoom: 9,
    paint: {

      'heatmap-weight': [
        'interpolate',
        ['linear'],
        ['get', 'solar'],
        1600, 0,
        2200, 1
      ],

      'heatmap-intensity': 1,

      'heatmap-color': [
        'interpolate',
        ['linear'],
        ['heatmap-density'],
        0, 'rgba(0,0,255,0)',
        0.2, 'blue',
        0.4, 'cyan',
        0.6, 'yellow',
        0.8, 'orange',
        1, 'red'
      ],

      'heatmap-radius': 50,
      'heatmap-opacity': 0.6
    }
  });

});

</script>

</body>
</html>
